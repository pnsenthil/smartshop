(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))t(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&t(o)}).observe(document,{childList:!0,subtree:!0});function s(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(a){if(a.ep)return;a.ep=!0;const r=s(a);fetch(a.href,r)}})();const Z="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let S=(l=21)=>{let e="",s=crypto.getRandomValues(new Uint8Array(l|=0));for(;l--;)e+=Z[s[l]&63];return e};const Y=[{productId:"pasta-500g",name:"Sainsbury's Penne Pasta 500g",brand:"Sainsbury's",category:"Food",subCategory:"Pasta & Rice",tags:["pasta","italian","dried"],diet:["vegetarian"],price:1.25,nectarPrice:1.25,promo:{type:"multi-buy",value:2,threshold:2,groupId:"pasta-deal"},valueBand:"value",isInStock:!0},{productId:"pasta-sauce-350g",name:"Sainsbury's Tomato & Basil Sauce 350g",brand:"Sainsbury's",category:"Food",subCategory:"Cooking Sauces",tags:["sauce","tomato","pasta-sauce"],diet:["vegetarian"],price:.95,nectarPrice:.85,promo:null,valueBand:"value",isInStock:!0},{productId:"falafel-200g",name:"Sainsbury's Falafel 200g",brand:"Sainsbury's",category:"Food",subCategory:"Middle Eastern",tags:["falafel","vegan","snack"],diet:["vegan"],price:2.5,nectarPrice:2.5,promo:{type:"multi-buy",value:1,threshold:2,groupId:"deli-pair"},valueBand:"balanced",isInStock:!0},{productId:"houmous-200g",name:"Sainsbury's Houmous 200g",brand:"Sainsbury's",category:"Food",subCategory:"Dips & Spreads",tags:["houmous","vegan","dip"],diet:["vegan"],price:1.8,nectarPrice:1.5,promo:{type:"multi-buy",value:1,threshold:2,groupId:"deli-pair"},valueBand:"balanced",isInStock:!0},{productId:"pitta-bread-6pk",name:"Sainsbury's Pitta Bread 6 Pack",brand:"Sainsbury's",category:"Food",subCategory:"Bakery",tags:["bread","pitta"],diet:["vegan"],price:1.2,nectarPrice:1.2,promo:null,valueBand:"value",isInStock:!0},{productId:"bread-400g",name:"Sainsbury's Wholemeal Bread 400g",brand:"Sainsbury's",category:"Food",subCategory:"Bakery",tags:["bread","wholemeal"],diet:["vegetarian"],price:1,nectarPrice:.95,promo:null,valueBand:"value",isInStock:!0},{productId:"milk-1l",name:"Sainsbury's Semi-Skimmed Milk 1L",brand:"Sainsbury's",category:"Food",subCategory:"Dairy",tags:["milk","dairy"],diet:["vegetarian"],price:.95,nectarPrice:.95,promo:null,valueBand:"value",isInStock:!0,perishableDays:5},{productId:"cheese-200g",name:"Sainsbury's Cheddar Cheese 200g",brand:"Sainsbury's",category:"Food",subCategory:"Dairy",tags:["cheese","dairy"],diet:["vegetarian"],price:2.5,nectarPrice:2.5,promo:null,valueBand:"balanced",isInStock:!0},{productId:"butter-250g",name:"Sainsbury's Salted Butter 250g",brand:"Sainsbury's",category:"Food",subCategory:"Dairy",tags:["butter","dairy"],diet:["vegetarian"],price:1.8,nectarPrice:1.5,promo:null,valueBand:"balanced",isInStock:!0},{productId:"premium-pasta-400g",name:"Sainsbury's Taste the Difference Penne 400g",brand:"Sainsbury's",category:"Food",subCategory:"Pasta & Rice",tags:["pasta","italian","premium"],diet:["vegetarian"],price:2,nectarPrice:1.8,promo:null,valueBand:"premium",isInStock:!0},{productId:"whole-chicken-1kg",name:"Sainsbury's Whole Chicken 1kg",brand:"Sainsbury's",category:"Food",subCategory:"Meat & Poultry",tags:["chicken","roast"],diet:[],price:5.5,nectarPrice:5.5,promo:null,valueBand:"premium",isInStock:!0},{productId:"potatoes-2kg",name:"Sainsbury's Maris Piper Potatoes 2kg",brand:"Sainsbury's",category:"Food",subCategory:"Vegetables",tags:["potatoes","roast"],diet:["vegan"],price:2.2,nectarPrice:2.2,promo:null,valueBand:"value",isInStock:!0},{productId:"carrots-1kg",name:"Sainsbury's Carrots 1kg",brand:"Sainsbury's",category:"Food",subCategory:"Vegetables",tags:["carrots","roast"],diet:["vegan"],price:1.5,nectarPrice:1.5,promo:null,valueBand:"value",isInStock:!0},{productId:"gravy-granules-200g",name:"Sainsbury's Chicken Gravy Granules 200g",brand:"Sainsbury's",category:"Food",subCategory:"Cooking Sauces",tags:["gravy","roast"],diet:["vegetarian"],price:1.3,nectarPrice:1.2,promo:null,valueBand:"value",isInStock:!0},{productId:"cereal-500g",name:"Sainsbury's Cornflakes 500g",brand:"Sainsbury's",category:"Food",subCategory:"Breakfast",tags:["cereal","breakfast"],diet:["vegetarian"],price:2.5,nectarPrice:2.3,promo:null,valueBand:"balanced",isInStock:!0,nectarPointsBonus:50},{productId:"orange-juice-1l",name:"Sainsbury's Orange Juice 1L",brand:"Sainsbury's",category:"Food",subCategory:"Beverages",tags:["juice","breakfast"],diet:["vegan"],price:1.8,nectarPrice:1.5,promo:null,valueBand:"balanced",isInStock:!0},{productId:"eggs-6pk",name:"Sainsbury's Free Range Eggs 6pk",brand:"Sainsbury's",category:"Food",subCategory:"Dairy",tags:["eggs","breakfast"],diet:["vegetarian"],price:2,nectarPrice:1.9,promo:null,valueBand:"balanced",isInStock:!0},{productId:"yogurt-500g",name:"Sainsbury's Natural Yogurt 500g",brand:"Sainsbury's",category:"Food",subCategory:"Dairy",tags:["yogurt","dairy"],diet:["vegetarian"],price:1.5,nectarPrice:1.3,promo:null,valueBand:"value",isInStock:!0,perishableDays:7},{productId:"tea-100bags",name:"Sainsbury's English Breakfast Tea 100 Bags",brand:"Sainsbury's",category:"Food",subCategory:"Beverages",tags:["tea","hot drink"],diet:["vegan"],price:3,nectarPrice:2.8,promo:null,valueBand:"balanced",isInStock:!0},{productId:"coffee-200g",name:"Sainsbury's Ground Coffee 200g",brand:"Sainsbury's",category:"Food",subCategory:"Beverages",tags:["coffee","hot drink"],diet:["vegan"],price:4.5,nectarPrice:4,promo:null,valueBand:"premium",isInStock:!0},{productId:"chocolate-100g",name:"Sainsbury's Milk Chocolate 100g",brand:"Sainsbury's",category:"Food",subCategory:"Confectionery",tags:["chocolate","snack"],diet:["vegetarian"],price:.9,nectarPrice:.85,promo:null,valueBand:"value",isInStock:!0},{productId:"crisps-150g",name:"Sainsbury's Salted Crisps 150g",brand:"Sainsbury's",category:"Food",subCategory:"Snacks",tags:["crisps","snack"],diet:["vegan"],price:1.2,nectarPrice:1.1,promo:null,valueBand:"value",isInStock:!0},{productId:"soup-400ml",name:"Sainsbury's Tomato Soup 400ml",brand:"Sainsbury's",category:"Food",subCategory:"Canned",tags:["soup","vegetarian"],diet:["vegetarian"],price:1.5,nectarPrice:1.3,promo:null,valueBand:"value",isInStock:!0},{productId:"olive-oil-500ml",name:"Sainsbury's Extra Virgin Olive Oil 500ml",brand:"Sainsbury's",category:"Food",subCategory:"Cooking Oils",tags:["olive","oil","premium"],diet:["vegan"],price:5,nectarPrice:4.5,promo:null,valueBand:"premium",isInStock:!0},{productId:"tomatoes-6pk",name:"Sainsbury's Vine Tomatoes 6 Pack",brand:"Sainsbury's",category:"Food",subCategory:"Vegetables",tags:["tomatoes","vegan"],diet:["vegan"],price:2,nectarPrice:2,promo:null,valueBand:"value",isInStock:!0},{productId:"cucumber-1pk",name:"Sainsbury's Cucumber 1pk",brand:"Sainsbury's",category:"Food",subCategory:"Vegetables",tags:["cucumber","vegan"],diet:["vegan"],price:.85,nectarPrice:.8,promo:null,valueBand:"value",isInStock:!0},{productId:"bell-peppers-3pk",name:"Sainsbury's Mixed Bell Peppers 3 Pack",brand:"Sainsbury's",category:"Food",subCategory:"Vegetables",tags:["peppers","vegan"],diet:["vegan"],price:2.5,nectarPrice:2.5,promo:null,valueBand:"balanced",isInStock:!0},{productId:"spinach-200g",name:"Sainsbury's Baby Spinach 200g",brand:"Sainsbury's",category:"Food",subCategory:"Vegetables",tags:["spinach","vegan"],diet:["vegan"],price:1.5,nectarPrice:1.5,promo:null,valueBand:"balanced",isInStock:!0},{productId:"almonds-200g",name:"Sainsbury's Roasted Almonds 200g",brand:"Sainsbury's",category:"Food",subCategory:"Snacks",tags:["nuts","vegan"],diet:["vegan"],price:3.5,nectarPrice:3,promo:null,valueBand:"premium",isInStock:!0},{productId:"granola-500g",name:"Sainsbury's Honey & Nut Granola 500g",brand:"Sainsbury's",category:"Food",subCategory:"Breakfast",tags:["granola","breakfast"],diet:["vegetarian"],price:3,nectarPrice:2.7,promo:null,valueBand:"balanced",isInStock:!0},{productId:"apple-1kg",name:"Sainsbury's Apples 1kg",brand:"Sainsbury's",category:"Food",subCategory:"Fruits",tags:["apple","vegan"],diet:["vegan"],price:2.2,nectarPrice:2.2,promo:null,valueBand:"value",isInStock:!0},{productId:"banana-1kg",name:"Sainsbury's Bananas 1kg",brand:"Sainsbury's",category:"Food",subCategory:"Fruits",tags:["banana","vegan"],diet:["vegan"],price:1.8,nectarPrice:1.8,promo:null,valueBand:"value",isInStock:!0},{productId:"strawberries-400g",name:"Sainsbury's Strawberries 400g",brand:"Sainsbury's",category:"Food",subCategory:"Fruits",tags:["strawberry","vegan"],diet:["vegan"],price:3,nectarPrice:2.7,promo:null,valueBand:"balanced",isInStock:!0,perishableDays:3}];Y.push({productId:"toilet-tissue-9-roll",name:"Sainsbury's Toilet Tissue 9 Roll",brand:"Sainsbury's",category:"Home",subCategory:"Household",tags:["tissue","household"],diet:[],price:3.7,nectarPrice:3.2,promo:null,valueBand:"balanced",isInStock:!0},{productId:"toilet-tissue-12-roll",name:"Sainsbury's Toilet Tissue 12 Roll",brand:"Sainsbury's",category:"Home",subCategory:"Household",tags:["tissue","bulk"],diet:[],price:6.5,nectarPrice:5.8,promo:null,valueBand:"balanced",isInStock:!0},{productId:"sourdough-loaf",name:"Sainsbury's Sourdough Loaf",brand:"Sainsbury's",category:"Food",subCategory:"Bakery",tags:["bread","fresh"],diet:["vegan"],price:2.5,nectarPrice:2.5,promo:null,valueBand:"balanced",isInStock:!0},{productId:"sugar-500g",name:"Sainsbury's Caster Sugar 500g",brand:"Sainsbury's",category:"Food",subCategory:"Baking",tags:["sugar","baking"],diet:["vegan"],price:.95,nectarPrice:.9,promo:null,valueBand:"value",isInStock:!0},{productId:"apple-slices-100g",name:"Apple Slices 100g",brand:"Sainsbury's",category:"Food",subCategory:"Snacks",tags:["kids","snack"],diet:["vegan"],price:.9,nectarPrice:.85,promo:null,valueBand:"value",isInStock:!0,perishableDays:2},{productId:"cheese-sticks-50g",name:"Cheese Sticks 50g",brand:"Sainsbury's",category:"Food",subCategory:"Snacks",tags:["kids","snack","dairy"],diet:["vegetarian"],price:1.2,nectarPrice:1.1,promo:null,valueBand:"balanced",isInStock:!0},{productId:"vegan-cheese-150g",name:"Vegan Cheese 150g",brand:"Sainsbury's",category:"Food",subCategory:"Dairy Alternatives",tags:["vegan","cheese"],diet:["vegan"],price:2.2,nectarPrice:2,promo:null,valueBand:"balanced",isInStock:!0},{productId:"milk-4l",name:"Sainsbury's Semi-Skimmed Milk 4L",brand:"Sainsbury's",category:"Food",subCategory:"Dairy",tags:["milk","dairy","family-size"],diet:["vegetarian"],price:2.1,nectarPrice:2.1,promo:null,valueBand:"value",isInStock:!0,perishableDays:5},{productId:"milk-2l",name:"Sainsbury's Semi-Skimmed Milk 2L",brand:"Sainsbury's",category:"Food",subCategory:"Dairy",tags:["milk","dairy"],diet:["vegetarian"],price:1.25,nectarPrice:1.25,promo:null,valueBand:"value",isInStock:!0,perishableDays:5},{productId:"bread-2for2",name:"Sainsbury's White Bread Loaf",brand:"Sainsbury's",category:"Food",subCategory:"Bakery",tags:["bread","family"],diet:["vegetarian"],price:1.2,nectarPrice:1.2,promo:{type:"multi-buy",value:.6,threshold:2,groupId:"bread-2for2"},valueBand:"value",isInStock:!0},{productId:"greek-yogurt-500g",name:"Sainsbury's Greek Yogurt 500g",brand:"Sainsbury's",category:"Food",subCategory:"Dairy",tags:["yogurt","protein","health"],diet:["vegetarian"],price:2.5,nectarPrice:2.5,promo:null,valueBand:"balanced",isInStock:!0,perishableDays:7},{productId:"protein-granola-400g",name:"High-Protein Granola 400g",brand:"Sainsbury's",category:"Food",subCategory:"Breakfast",tags:["granola","protein","fitness"],diet:["vegetarian"],price:2.5,nectarPrice:2.5,promo:{type:"intro-price",value:.5,threshold:1},valueBand:"balanced",isInStock:!0},{productId:"energy-bar-regular",name:"Regular Energy Bar",brand:"Sainsbury's",category:"Food",subCategory:"Snacks",tags:["energy-bar","snack"],diet:["vegetarian"],price:1.2,nectarPrice:1.2,promo:null,valueBand:"balanced",isInStock:!0},{productId:"protein-bar-lowsugar",name:"High-Protein Low-Sugar Bar",brand:"Sainsbury's",category:"Food",subCategory:"Snacks",tags:["protein-bar","low-sugar","fitness"],diet:["vegetarian"],price:1.2,nectarPrice:1.2,promo:null,valueBand:"balanced",isInStock:!0},{productId:"ready-meal-curry",name:"Ready Meal: Chicken Curry",brand:"Sainsbury's",category:"Food",subCategory:"Ready Meals",tags:["curry","convenience","ready-meal"],diet:[],price:3.5,nectarPrice:3.5,promo:null,valueBand:"balanced",isInStock:!0},{productId:"microwave-rice",name:"Microwave Rice (90s)",brand:"Sainsbury's",category:"Food",subCategory:"Rice",tags:["rice","convenience","quick"],diet:["vegan"],price:.95,nectarPrice:.95,promo:null,valueBand:"value",isInStock:!0},{productId:"wine-bottle",name:"Sainsbury's House Wine",brand:"Sainsbury's",category:"Alcohol",subCategory:"Wine",tags:["wine","evening"],diet:["vegan"],price:5.5,nectarPrice:5.5,promo:null,valueBand:"balanced",isInStock:!0},{productId:"deli-pizza",name:"Deli Pizza",brand:"Sainsbury's",category:"Food",subCategory:"Ready Meals",tags:["pizza","convenience","deli"],diet:["vegetarian"],price:3.5,nectarPrice:3.5,promo:null,valueBand:"balanced",isInStock:!0});const ee={"pasta-500g":["pasta-sauce-350g"],"falafel-200g":["houmous-200g","pitta-bread-6pk"],"whole-chicken-1kg":["potatoes-2kg","carrots-1kg","gravy-granules-200g"],"granola-500g":["milk-1l","yogurt-500g"],"tea-100bags":["milk-1l","sugar-500g"],"bell-peppers-3pk":["olive-oil-500ml","tomatoes-6pk","spinach-200g"],"toilet-tissue-9-roll":["toilet-tissue-12-roll"]},te={"sunday-roast":["whole-chicken-1kg","potatoes-2kg","carrots-1kg","gravy-granules-200g"],"breakfast-combo":["cereal-500g","milk-1l","yogurt-500g","granola-500g"]},u=Object.fromEntries(Y.map(l=>{const e=l.productId,s=l.promo?l.promo.type==="multi-buy"?{type:"multibuy",value:l.promo.value,threshold:l.promo.threshold,groupId:l.promo.groupId}:l.promo.type==="discount"?{type:"price_drop",value:l.promo.value,groupId:l.promo.groupId}:void 0:l.nectarPrice&&l.nectarPrice<l.price?{type:"nectar",nectarPrice:l.nectarPrice,isInStock:l.isInStock}:void 0,t={sku:e,name:l.name,brand:l.brand,price:l.price,dietTags:l.diet||[],categories:[l.category.toLowerCase(),l.subCategory.toLowerCase()],tags:l.tags||[],promo:s,missionTags:[],perishableDays:l.perishableDays,nectarPointsBonus:l.nectarPointsBonus};return[e,t]}));u["pasta-500g"]&&(u["pasta-penne"]=u["pasta-500g"]);u["pasta-sauce-350g"]&&(u["pasta-sauce"]=u["pasta-sauce-350g"]);u["falafel-200g"]&&(u.falafel=u["falafel-200g"]);u["houmous-200g"]&&(u.houmous=u["houmous-200g"]);u["carrots-1kg"]&&(u.carrots=u["carrots-1kg"]);u["gravy-granules-200g"]&&(u.gravy=u["gravy-granules-200g"]);u["whole-chicken-1kg"]&&(u["chicken-breast"]=u["whole-chicken-1kg"]);const v=ee,ae=te;v["pasta-500g"]&&(v["pasta-penne"]=v["pasta-500g"]);v["houmous-200g"]&&(v.houmous=v["houmous-200g"]);v["falafel-200g"]&&(v.falafel=v["falafel-200g"]);v["gravy-granules-200g"]&&(v.gravy=v["gravy-granules-200g"]);v["carrots-1kg"]&&(v.carrots=v["carrots-1kg"]);v["whole-chicken-1kg"]&&(v["chicken-breast"]=v["whole-chicken-1kg"]);class re{getBasketProducts(e){return e.flatMap(s=>Array.from({length:s.qty},()=>u[s.sku])).filter(Boolean)}countByGroup(e,s){return this.getBasketProducts(e).filter(a=>a.promo?.groupId===s).length}computeMultibuySavingsIfOneAway(e){const s=this.getBasketProducts(e),t=new Map;for(const r of s)if(r.promo?.type==="multibuy"&&r.promo.groupId){const o=r.promo.threshold||2,d=t.get(r.promo.groupId)||{count:0,threshold:o,groupPriceSample:[],dealPrice:r.promo.value||0};d.count+=1,d.groupPriceSample.push(r.price),r.promo.value&&(d.dealPrice===0||r.promo.value<d.dealPrice)&&(d.dealPrice=r.promo.value),t.set(r.promo.groupId,d)}const a=[];for(const[r,o]of t){const d=o.count%o.threshold,c=d===0?0:o.threshold-d;if(c===1){const b=o.groupPriceSample.length>0?o.groupPriceSample:[0],P=b.reduce((w,$)=>w+$,0)/b.length,y=o.threshold*P,x=o.dealPrice>0&&o.dealPrice<y?o.dealPrice:y,F=Math.max(0,y-x);a.push({groupId:r,needed:c,potentialSaving:Number(F.toFixed(2))})}}return a}}class se{constructor(){this.basketAnalyzer=new re}generateCandidates(e,s){const t=e.scans[e.scans.length-1],a=[];return t&&(a.push(...this.generateComplement(t.sku,s)),a.push(...this.generateSubstitute(t.sku,s)),a.push(...this.generateTradeUp(t.sku,s))),a.push(...this.generateMultibuy(e.basket)),a.push(...this.generateMission(e.basket,s)),a.push(...this.generateHoldOff(e.basket,s)),a.push(...this.generateStockUp(e.basket,s)),a.push(...this.generateStoreSpecific(e,s)),a.push(...this.generateNectarPoints(e,s)),a}dietaryOk(e,s){const t=s.dietTags.every(o=>e.dietTags.includes(o)),a=!s.avoidBrands.includes(e.brand),r=(s.allergyProfile||[]).every(o=>!(e.tags||[]).includes(o));return t&&a&&r}generateComplement(e,s){const a=(v[e]||[]).map(c=>u[c]).filter(Boolean).filter(c=>this.dietaryOk(c,s));if(a.length===0)return[];const r="Complete your meal",o="Goes well with what you just scanned",d=a.reduce((c,b)=>c+(b.promo?.type==="nectar"&&b.promo.nectarPrice?b.price-b.promo.nectarPrice:0),0);return[{id:S(),type:"complement",title:r,reason:o,products:a,savings:d}]}generateMultibuy(e){const s=this.basketAnalyzer.computeMultibuySavingsIfOneAway(e),t=[];for(const a of s){const r=Object.values(u).find(o=>o.promo?.groupId===a.groupId);r&&t.push({id:S(),type:"multibuy",title:"You're one away from a multibuy",reason:`Add 1 more to save Â£${a.potentialSaving.toFixed(2)}`,products:[r],savings:a.potentialSaving})}return t}generateSubstitute(e,s){const t=u[e];if(!t)return[];const a=Object.values(u).filter(c=>c.categories.some(b=>t.categories.includes(b))&&c.sku!==t.sku),r=[];for(const c of a)this.dietaryOk(c,s)&&(s.valueBias==="value"?(c.promo?.type==="nectar"&&c.promo.nectarPrice&&c.promo.nectarPrice<t.price||(c.promo?.valueBand==="low"||c.price<t.price)&&c.price<=t.price*.9)&&r.push(c):s.valueBias==="premium"?c.price>t.price&&c.brand!=="Sainsbury's Basics"&&r.push(c):(c.price<=t.price||c.promo?.type==="nectar"&&c.promo.nectarPrice&&c.promo.nectarPrice<t.price)&&r.push(c));if(r.length===0)return[];const o=r.sort((c,b)=>(c.promo?.nectarPrice??c.price)-(b.promo?.nectarPrice??b.price))[0],d=Math.max(0,t.price-(o.promo?.nectarPrice??o.price));return[{id:S(),type:"substitute",title:"Better value available",reason:"Swap to save",products:[o],savings:d}]}generateMission(e,s){const t=new Set(e.map(r=>r.sku)),a=[];for(const[r,o]of Object.entries(ae)){const d=o.filter(c=>!t.has(c)).map(c=>u[c]).filter(Boolean).filter(c=>this.dietaryOk(c,s));if(d.length>0&&d.length<o.length){const c=d.reduce((b,P)=>b+(P.promo?.type==="nectar"&&P.promo.nectarPrice?P.price-P.promo.nectarPrice:0),0);a.push({id:S(),type:"mission",title:"Finish your recipe",reason:`Complete ${r.replace("_"," ")}`,products:d.slice(0,3),savings:c})}}return a}generateStoreSpecific(e,s){if(!e.timeOfDay)return[];const t=Number(e.timeOfDay.split(":")[0]||0);if(t>=7&&t<=10){const a=[];if(["cereal-500g","milk-1l","orange-juice-1l"].forEach(r=>{u[r]&&a.push(u[r])}),a.length)return[{id:S(),type:"store",title:"Morning specials",reason:"Breakfast picks for now",products:a.slice(0,3),savings:0}]}return[]}generateTradeUp(e,s){const t=u[e];if(!t)return[];const a=Object.values(u).filter(c=>c.categories.some(b=>t.categories.includes(b))&&c.price>t.price&&c.brand.includes("Taste the Difference"));if(a.length===0)return[];const r=a.sort((c,b)=>b.price-c.price)[0];if(!this.dietaryOk(r,s))return[];const o="Upgrade for your occasion",d=`Try premium ${r.name}`;return[{id:S(),type:"tradeup",title:o,reason:d,products:[r],savings:0}]}generateStockUp(e,s){const t=new Map;for(const r of e)t.set(r.sku,(t.get(r.sku)||0)+r.qty);const a=[];if(t.has("toilet-tissue-9-roll")&&u["toilet-tissue-12-roll"]){const r=u["toilet-tissue-12-roll"];a.push({id:S(),type:"stockup",title:"Stock up and save",reason:"Bigger pack for the week",products:[r],savings:0})}return a}generateNectarPoints(e,s){if(!(s.valueBias==="value"||s.valueBias==="balanced"))return[];const t=new Set(e.basket.map(o=>o.sku)),a=Object.values(u).filter(o=>(o.nectarPointsBonus||0)>0&&!t.has(o.sku));if(a.length===0)return[];const r=a.sort((o,d)=>(d.nectarPointsBonus||0)-(o.nectarPointsBonus||0))[0];return this.dietaryOk(r,s)?[{id:S(),type:"nectar_points",title:"Earn bonus Nectar points",reason:`Get ${r.nectarPointsBonus} extra points`,products:[r],savings:0}]:[]}generateHoldOff(e,s){const a=e.map(d=>({item:d,product:u[d.sku]})).filter(d=>d.product).filter(d=>(d.product.perishableDays||0)>0);if(a.length===0)return[];const r=a.reduce((d,c)=>d+c.item.qty,0),o=a.some(d=>(d.product.perishableDays||99)<=3);if(r>=3&&o){const d=a.slice(0,2).map(c=>c.product);return[{id:S(),type:"holdoff",title:"Heads up: perishables may expire",reason:"Avoid overbuying items that expire soon",products:d,savings:0}]}return[]}}class ne{rank(e,s){return e.map(a=>({...a,score:this.scoreCandidate(a,s)})).sort((a,r)=>(r.score??0)-(a.score??0))}scoreCandidate(e,s){let t=0;e.type==="complement"&&(t+=7),e.type==="multibuy"&&(t+=6),e.type==="substitute"&&(t+=3),e.type==="mission"&&(t+=2),e.type==="tradeup"&&(t+=2),e.type==="stockup"&&(t+=1),e.type==="nectar_points"&&(t+=s.valueBias==="value"?4:2),t+=Math.min(10,e.savings*2);const a=e.type==="nectar_points"&&e.products[0]?.nectarPointsBonus||0;return a&&(t+=Math.min(10,a/10*(s.valueBias==="value"?1.5:1))),s.valueBias==="value"&&(e.type==="substitute"||e.type==="multibuy")&&(t+=3),t-=Math.max(0,e.products.length-2),t}}class oe{constructor(e=3){this.scansBetweenNudges=e}canServeNudge(e){const s=e.scans.length;return e.lastNudgeScanIndex===void 0?!0:s-e.lastNudgeScanIndex>=this.scansBetweenNudges}hasSeenCandidate(e,s){return e.nudgeHistory.includes(s)}}class ie{constructor(){this.generator=new se,this.ranker=new ne,this.throttle=new oe(3)}processScan(e,s,t){e.scans.push(t);const a=this.generator.generateCandidates(e,s),r=this.ranker.rank(a,s);if(!this.throttle.canServeNudge(e))return null;for(const o of r)if(!this.throttle.hasSeenCandidate(e,o.id))return e.nudgeHistory.push(o.id),e.lastNudgeScanIndex=e.scans.length,o;return null}async processScanAI(e,s,t){e.scans.push(t);const a=this.generator.generateCandidates(e,s);let r=this.ranker.rank(a,s);if(r.length>0)try{const o=await fetch("http://localhost:8787/rerank",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({candidates:r,profile:s,session:e})});if(o.ok){const d=await o.json();Array.isArray(d?.candidates)&&d.candidates.length>0&&(r=d.candidates)}}catch{}if(!this.throttle.canServeNudge(e))return null;for(const o of r)if(!this.throttle.hasSeenCandidate(e,o.id))return e.nudgeHistory.push(o.id),e.lastNudgeScanIndex=e.scans.length,o;return null}}const T={"budget-family":{id:"budget-family-shopper",profileType:"budget-family",displayName:"Budget-conscious Family Shopper",description:"Weekly shop, large household, prefers multi-buy deals, price sensitive",traits:["Weekly shopping trips","Large household","Multi-buy deals","Price sensitive","Bulk purchases"],dietTags:[],avoidBrands:[],valueBias:"value",budgetBand:"low",allergyProfile:[]},"health-fitness":{id:"health-fitness-enthusiast",profileType:"health-fitness",displayName:"Health & Fitness Enthusiast",description:"Active lifestyle, prefers high-protein and low-sugar products, spends more on nutritional items",traits:["Active lifestyle","High-protein preference","Low-sugar focus","Nutrition conscious","Premium health products"],dietTags:[],avoidBrands:[],valueBias:"premium",budgetBand:"high",allergyProfile:[]},"convenience-professional":{id:"convenience-professional",profileType:"convenience-professional",displayName:"Convenience-driven Young Professional",description:"Small basket, frequent top-up shops, values ready-to-eat and quick-prep meals",traits:["Small basket size","Frequent shopping","Quick preparation","Ready-to-eat meals","Time-conscious"],dietTags:[],avoidBrands:[],valueBias:"balanced",budgetBand:"mid",allergyProfile:[]}},ce={"budget-family":[{triggerProduct:"milk-2l",nudgeType:"family-optimizer",title:"ğŸ’° Family-Size Optimizer",reason:"Families like yours save Â£0.40 by choosing the 4L option. Less shopping trips, more family time!",recommendedProducts:["milk-4l"],savings:.4,ctaText:{primary:"Swap to 4L",secondary:"Keep 2L"},persuasiveCopy:{headline:"Smart families choose bigger",subtext:"Save money and reduce weekly shopping trips",urgency:"40p savings - every penny counts!"}},{triggerProduct:"bread-2for2",nudgeType:"multibuy-completion",title:"ğŸ¯ Complete Your Deal",reason:"Budget-conscious shoppers never miss a deal! Add another loaf to unlock 60p savings for your family.",recommendedProducts:["bread-2for2"],savings:.6,ctaText:{primary:"Complete Deal",secondary:"Just one loaf"},persuasiveCopy:{headline:"You're halfway to savings",subtext:"Complete the family deal and save 60p",urgency:"Multi-buy deals end today!"}}],"health-fitness":[{triggerProduct:"greek-yogurt-500g",nudgeType:"protein-complement",title:"ğŸ’ª Performance Pairing",reason:"Maximize your protein intake! This high-protein granola contains 25g protein per serving - perfect for your active lifestyle.",recommendedProducts:["protein-granola-400g"],savings:.5,ctaText:{primary:"Power Up",secondary:"Skip"},persuasiveCopy:{headline:"Fuel your performance",subtext:"Complete protein breakfast = better workouts",urgency:"Intro price - serious athletes act fast!"}},{triggerProduct:"energy-bar-regular",nudgeType:"better-fit-substitute",title:"ğŸ¯ Fitness Upgrade",reason:"Level up your nutrition! This bar has 40% more protein and 60% less sugar - perfect for your fitness goals.",recommendedProducts:["protein-bar-lowsugar"],savings:0,ctaText:{primary:"Upgrade Fuel",secondary:"Keep current"},persuasiveCopy:{headline:"Upgrade your fuel",subtext:"More protein, less sugar = better results",urgency:"Train smarter, not harder!"}}],"convenience-professional":[{triggerProduct:"ready-meal-curry",nudgeType:"meal-completion",title:"âš¡ Instant Dinner Solution",reason:"Busy professionals deserve complete meals! Add this 90-second rice to avoid the hassle of cooking sides.",recommendedProducts:["microwave-rice"],savings:0,ctaText:{primary:"Complete Meal",secondary:"Just curry"},persuasiveCopy:{headline:"Dinner sorted in 90 seconds",subtext:"No prep, no cleanup, no stress",urgency:"Perfect for your busy schedule!"}},{triggerProduct:"wine-bottle",nudgeType:"occasion-upgrade",title:"ğŸ• Weekend Treat",reason:"You've earned this! Professionals who work hard deserve the perfect Friday night combo.",recommendedProducts:["deli-pizza"],savings:0,ctaText:{primary:"Treat Yourself",secondary:"Just wine"},persuasiveCopy:{headline:"Your night-in awaits",subtext:"Wine + pizza = weekend perfection",urgency:"You deserve this after a long week!"}}]};function G(l="budget-family"){const e=new ie,s={basket:[],scans:[],nudgeHistory:[]},t=T[l];return{engine:e,session:s,user:t,scenarios:ce[l]}}function de(l){let e="budget-family",{engine:s,session:t,user:a,scenarios:r}=G(e),o=!0;l.innerHTML=`
    <div class="container">
      <div class="header">
        <div class="logo"><span class="dot"></span> SmartShop Nudges</div>
        <div style="display:flex; align-items:center; gap:10px;">
          <span class="badge-agentic"><span id="aiStatusDot" class="status-dot status-offline"></span>Agentic: Gemini Re-ranker</span>
          <label style="font-size:12px; color:var(--muted)">Enable
            <input id="aiToggle" type="checkbox" ${o?"checked":""} />
          </label>
          <div class="scan-meta">Throttling: 1 per 3 scans</div>
        </div>
      </div>
      
      <!-- Profile Selector -->
      <div class="profile-selector" id="profile-selector"></div>
      <div class="profile-info" id="profile-info"></div>
      
      <div class="layout">
        <div>
          <div class="nudge-activity">
            <div style="font-weight:700; margin-bottom:8px;">Nudge Activity</div>
            <div id="nudge-activity-log" style="font-size:12px; color:var(--muted)">No nudges yet</div>
          </div>
          <div class="basket" id="basket">
            <div style="font-weight:700; margin-bottom:8px;">Products to Try</div>
            <div id="nudge-trigger-guide" style="font-size:12px; margin-bottom:12px;"></div>
            <div style="font-weight:700; margin-bottom:8px;">Your Basket</div>
            <div id="basket-items" style="font-size:14px; color:var(--muted)">Empty - Select products above to discover smart nudges</div>
          </div>
        </div>
        <div class="phone">
          <div class="phone-notch"></div>
          <div class="phone-screen">
            <div class="phone-content" id="phone-content">
              <div class="mobile-header">
                <div class="mobile-app-name">SmartShop</div>
                <div class="mobile-tagline">Smart shopping made simple</div>
              </div>
              
              <div class="mobile-products">
                <div class="mobile-products-title">
                  ğŸ›ï¸ Shop Products
                  <span style="font-size:10px; color:var(--muted); margin-left:auto;" id="product-count">0 products</span>
                </div>
                <div class="mobile-products-grid" id="mobile-products-grid"></div>
              </div>
              
              <div class="phone-card">
                <h3>Basket</h3>
                <div id="phone-basket"></div>
                <div class="basket-total"><span>Total</span><span id="phone-total">Â£0.00</span></div>
                <button id="checkout-btn" class="checkout-btn" style="display:none;">Proceed to Checkout</button>
              </div>
            </div>
            <div id="nudge" class="nudge-sheet" aria-live="polite"></div>
          </div>
        </div>
      </div>
    </div>
  `;const d=document.getElementById("profile-selector"),c=document.getElementById("profile-info"),b=document.getElementById("mobile-products-grid"),P=document.getElementById("product-count"),y=document.getElementById("nudge"),x=document.getElementById("basket-items"),F=document.getElementById("aiToggle"),w=document.getElementById("phone-basket"),$=document.getElementById("phone-total"),M=document.getElementById("nudge-trigger-guide"),I=document.getElementById("nudge-activity-log"),L=document.getElementById("aiStatusDot"),N=document.getElementById("checkout-btn");F?.addEventListener("change",()=>{o=!!F.checked}),N?.addEventListener("click",()=>K());function O(){d.innerHTML="",Object.entries(T).forEach(([n,i])=>{const g=document.createElement("button");g.className=`profile-btn ${n===e?"active":""}`,g.textContent=i.displayName,g.onclick=()=>U(n),d.appendChild(g)})}function z(){const n=T[e];c.innerHTML=`
      <div class="profile-name">${n.displayName}</div>
      <div class="profile-description">${n.description}</div>
      <div class="profile-traits">
        ${n.traits.map(i=>`<span class="trait-tag">${i}</span>`).join("")}
      </div>
    `}function D(){const n=T[e],i={"budget-family":"ğŸ’°","health-fitness":"ğŸ’ª","convenience-professional":"âš¡"},g=r.map(p=>{const f=u[p.triggerProduct];return f?`<div style="margin-bottom:8px; padding:8px 10px; background:rgba(255,121,0,0.08); border-radius:10px; border:1px solid rgba(255,121,0,0.15); cursor:pointer;" onclick="document.querySelector('[data-product=\\"${p.triggerProduct}\\"]')?.click()">
        <div style="font-weight:700; color:var(--brand-navy); font-size:12px; margin-bottom:2px;">ğŸ“± ${f.name} <span style="color:var(--brand-orange); font-size:9px;">(Top of mobile)</span></div>
        <div style="color:var(--brand-orange); font-size:10px; font-weight:600; text-transform:uppercase;">${p.title}</div>
        <div style="color:var(--muted); font-size:10px; margin-top:2px;">${p.persuasiveCopy.headline}</div>
      </div>`:""}).filter(p=>p!=="").join(""),m=i[e]||"ğŸ›’";M.innerHTML=g?`<div style="font-weight:700; color:var(--brand-navy); margin-bottom:10px; font-size:12px;">${m} ${n.displayName} - Try these products:</div>${g}`:""}function U(n){e=n;const i=G(n);s=i.engine,t=i.session,a=i.user,r=i.scenarios,O(),z(),D(),C(),H(),I.textContent="No nudges yet",y.classList.remove("open"),y.innerHTML=""}function C(){if(t.basket.length===0){x.textContent="Empty - Select products above to discover smart nudges",w.innerHTML='<div class="empty-basket">Your basket is empty</div>',$.textContent="Â£0.00",N.style.display="none";return}x.innerHTML="",w.innerHTML="";let n=0;for(const i of t.basket){const g=u[i.sku];if(!g)continue;const m=document.createElement("div");m.textContent=`${g.name} Ã— ${i.qty}`,x.appendChild(m);const p=document.createElement("div");p.className="basket-row",p.innerHTML=`<span>${g.name}</span><span class="qty-badge">Ã— ${i.qty}</span>`,w.appendChild(p),n+=g.price*i.qty}$.textContent=`Â£${n.toFixed(2)}`,N.style.display="block"}function H(){b.innerHTML="";const n=r.map(p=>p.triggerProduct),i=n.map(p=>u[p]).filter(p=>p),g=Object.values(u).filter(p=>!n.includes(p.sku)).slice(0,8),m=[...i,...g];P.textContent=`${m.length} products`;for(let p=0;p<m.length;p++){const f=m[p],h=document.createElement("div");h.className="mobile-product-card",h.setAttribute("data-product",f.sku),n.includes(f.sku)&&(h.style.boxShadow="0 2px 8px rgba(255, 121, 0, 0.08)",h.style.borderColor="rgba(255, 121, 0, 0.2)"),h.innerHTML=`
        <div class="mobile-product-name">${f.name}</div>
        <div class="mobile-product-price">Â£${f.price.toFixed(2)}</div>
      `,h.onclick=()=>V(f.sku),b.appendChild(h)}}function V(n){const i=r.find(m=>m.triggerProduct===n);if(i){const m=W(i);_(m,i,n);return}const g=t.basket.find(m=>m.sku===n);if(g?g.qty+=1:t.basket.push({sku:n,qty:1}),C(),o)s.processScanAI(t,a,{sku:n,timestamp:Date.now()}).then(m=>{m&&A(m)});else{const m=s.processScan(t,a,{sku:n,timestamp:Date.now()});m&&A(m)}}function W(n){const i=n.recommendedProducts.map(g=>u[g]).filter(g=>g);return{id:`custom-${n.nudgeType}-${Date.now()}`,type:n.nudgeType,title:n.title,reason:n.reason,products:i,savings:n.savings,score:1}}function _(n,i,g){R(n);const m=n.savings>0?`Save Â£${n.savings.toFixed(2)}`:"",p=J(i.nudgeType);y.setAttribute("role","dialog"),y.setAttribute("aria-label",`${n.title}. ${n.reason}. ${m}`),y.innerHTML=`
      <div class="nudge-header">
        <div class="nudge-type-indicator">${p}</div>
        <div class="nudge-headline">${i.persuasiveCopy.headline}</div>
        <div class="nudge-title">${i.title}</div>
        <div class="nudge-subtext">${i.persuasiveCopy.subtext}</div>
        ${i.persuasiveCopy.urgency?`<div class="nudge-urgency">${i.persuasiveCopy.urgency}</div>`:""}
      </div>
      <div class="nudge-reason">${n.reason}</div>
      <div class="nudge-products">
        ${n.products.map(f=>`<span class="tag">${f.name} - Â£${f.price.toFixed(2)}</span>`).join("")}
      </div>
      <div class="cta-row">
        ${m?`<span class="badge-save">${m}</span>`:""}
        <button id="addBtn" class="btn-primary">${i.ctaText.primary}</button>
        <button id="dismissBtn" class="btn-secondary">${i.ctaText.secondary}</button>
      </div>
    `,y.classList.add("open"),j(n,g)}function A(n){R(n);const i=`Save Â£${n.savings.toFixed(2)}`;y.setAttribute("role","dialog"),y.setAttribute("aria-label",`${n.title}. ${n.reason}. ${i}`),y.innerHTML=`
      <div class="nudge-header">
        <div class="nudge-title">${n.title}</div>
      </div>
      <div class="nudge-reason">${n.reason}</div>
      <div class="nudge-products">
        ${n.products.map(g=>`<span class="tag">${g.name}</span>`).join("")}
      </div>
      <div class="cta-row">
        <span class="badge-save">${i}</span>
        <button id="addBtn" class="btn-primary">Add</button>
        <button id="dismissBtn" class="btn-secondary">Dismiss</button>
      </div>
    `,y.classList.add("open"),j(n)}function j(n,i){const g=document.getElementById("addBtn"),m=document.getElementById("dismissBtn");g.onclick=()=>{if(i){const p=t.basket.find(f=>f.sku===i);p?p.qty+=1:t.basket.push({sku:i,qty:1})}for(const p of n.products){const f=t.basket.find(h=>h.sku===p.sku);f?f.qty+=1:t.basket.push({sku:p.sku,qty:1})}C(),y.classList.remove("open"),y.innerHTML=""},m.onclick=()=>{if(i&&r.find(h=>h.triggerProduct===i)?.nudgeType==="better-fit-substitute"){const h=t.basket.find(E=>E.sku===i);h?h.qty+=1:t.basket.push({sku:i,qty:1}),C()}y.classList.remove("open"),y.innerHTML=""}}function R(n){if(I){const g={"family-optimizer":"pill-stockup","multibuy-completion":"pill-multibuy","protein-complement":"pill-complement","better-fit-substitute":"pill-substitute","meal-completion":"pill-complement","occasion-upgrade":"pill-tradeup",complement:"pill-complement",multibuy:"pill-multibuy",substitute:"pill-substitute",mission:"pill-mission",tradeup:"pill-tradeup",stockup:"pill-stockup",holdoff:"pill-holdoff"}[n.type]||"pill-complement",m=document.createElement("div");m.style.marginBottom="6px",m.innerHTML=`<span class="pill ${g}">${n.type}</span> <span style="color:var(--brand-navy); font-weight:600;">${n.title}</span> <span style="color:var(--muted)">â€” ${n.reason}</span>`,I.textContent==="No nudges yet"&&(I.textContent="",M&&(M.style.opacity="0.6")),I.prepend(m)}}function J(n){return{"family-optimizer":"ğŸ’°","multibuy-completion":"ğŸ¯","protein-complement":"ğŸ’ª","better-fit-substitute":"ğŸ¯","meal-completion":"âš¡","occasion-upgrade":"ğŸ•"}[n]||"ğŸ›’"}function K(){const n=T[e];let i=0,g=0,m=[];I.children.length;for(const k of t.basket){const B=r.find(q=>q.triggerProduct===k.sku||q.recommendedProducts.includes(k.sku));B&&(i+=B.savings*k.qty,g++)}e==="budget-family"?m=[`ğŸ’° Saved Â£${i.toFixed(2)} with family-size deals`,"ğŸ  Reduced shopping trips with bulk purchases","ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Smart choices for your family budget"]:e==="health-fitness"?m=["ğŸ’ª Optimized protein intake for better performance",`ğŸ¯ Made ${g} fitness-focused choices`,"âš¡ Fueled your active lifestyle smartly"]:e==="convenience-professional"&&(m=["â° Saved time with complete meal solutions",`ğŸ¯ Made ${g} convenience-focused choices`,"ğŸ† Treated yourself after a productive week"]);let p=0;for(const k of t.basket){const B=u[k.sku];B&&(p+=B.price*k.qty)}const h={"budget-family":"ğŸ’°","health-fitness":"ğŸ’ª","convenience-professional":"âš¡"}[e];y.setAttribute("role","dialog"),y.setAttribute("aria-label","Checkout Summary"),y.innerHTML=`
      <div class="nudge-header">
        <div class="nudge-type-indicator">ğŸ›’</div>
        <div class="nudge-headline">Checkout Complete!</div>
        <div class="nudge-title">${h} ${n.displayName} Smart Shopping</div>
      </div>
      <div class="checkout-benefits">
        ${m.map(k=>`<div style="margin-bottom:8px; color:var(--deal-green); font-weight:600; font-size:12px;">${k}</div>`).join("")}
      </div>
      <div class="checkout-summary" style="margin:16px 0; padding:12px; background:rgba(31,143,78,0.1); border-radius:12px; border:1px solid rgba(31,143,78,0.2);">
        <div style="font-weight:700; color:var(--brand-navy); margin-bottom:8px;">Order Summary</div>
        <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
          <span style="color:var(--muted);">Items (${t.basket.reduce((k,B)=>k+B.qty,0)})</span>
          <span style="font-weight:600;">Â£${p.toFixed(2)}</span>
        </div>
        ${i>0?`<div style="display:flex; justify-content:space-between; margin-bottom:4px; color:var(--deal-green);">
          <span>Smart Savings</span>
          <span style="font-weight:700;">-Â£${i.toFixed(2)}</span>
        </div>`:""}
        <div style="border-top:1px solid rgba(31,143,78,0.3); margin:8px 0; padding-top:8px; display:flex; justify-content:space-between; font-weight:800; font-size:16px; color:var(--brand-navy);">
          <span>Total</span>
          <span>Â£${(p-i).toFixed(2)}</span>
        </div>
      </div>
      <div class="cta-row">
        <button id="completeBtn" class="btn-primary">Complete Order</button>
        <button id="continueBtn" class="btn-secondary">Continue Shopping</button>
      </div>
    `,y.classList.add("open");const E=document.getElementById("completeBtn"),X=document.getElementById("continueBtn");E.onclick=()=>{Q(n,i,g),setTimeout(()=>{t.basket=[],t.scans=[],t.nudgeHistory=[],C(),y.classList.remove("open"),y.innerHTML=""},3e3)},X.onclick=()=>{y.classList.remove("open"),y.innerHTML=""}}function Q(n,i,g){const p={"budget-family":"ğŸ’°","health-fitness":"ğŸ’ª","convenience-professional":"âš¡"}[e];y.innerHTML=`
      <div class="success-animation" style="text-align:center; padding:20px;">
        <div style="font-size:48px; margin-bottom:16px; animation: bounce 0.6s ease-in-out;">ğŸ‰</div>
        <div style="font-weight:800; font-size:18px; color:var(--deal-green); margin-bottom:12px;">
          Order Placed Successfully!
        </div>
        <div style="font-weight:600; color:var(--brand-navy); margin-bottom:16px; font-size:14px;">
          ${p} Thank you for smart shopping with<br>
          <span style="color:var(--brand-orange);">${n.displayName}</span> preferences
        </div>
        ${i>0?`<div style="background:rgba(31,143,78,0.1); padding:12px; border-radius:12px; border:1px solid rgba(31,143,78,0.2); margin-bottom:16px;">
          <div style="font-size:14px; font-weight:700; color:var(--deal-green);">
            ğŸ† You saved Â£${i.toFixed(2)} with smart choices!
          </div>
        </div>`:""}
        <div style="color:var(--muted); font-size:12px; margin-bottom:16px;">
          Made ${g} profile-optimized decisions
        </div>
        <div class="loading-dots" style="display:flex; justify-content:center; gap:4px;">
          <div style="width:8px; height:8px; background:var(--brand-orange); border-radius:50%; animation: pulse 1.5s infinite;"></div>
          <div style="width:8px; height:8px; background:var(--brand-orange); border-radius:50%; animation: pulse 1.5s infinite 0.2s;"></div>
          <div style="width:8px; height:8px; background:var(--brand-orange); border-radius:50%; animation: pulse 1.5s infinite 0.4s;"></div>
        </div>
        <div style="color:var(--muted); font-size:11px; margin-top:12px;">
          Resetting for next session...
        </div>
      </div>
    `}O(),z(),D(),H(),C(),window.location.hostname==="localhost"?fetch("http://localhost:8787/rerank",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({candidates:[],profile:a})}).then(()=>L?.classList.replace("status-offline","status-online")).catch(()=>L?.classList.replace("status-online","status-offline")):L?.classList.replace("status-offline","status-online")}const ue=document.getElementById("app");de(ue);
//# sourceMappingURL=index-CVmTW4Ev.js.map
